"use strict";(globalThis.webpackChunksimple_markers_map=globalThis.webpackChunksimple_markers_map||[]).push([[832],{832:(e,t,r)=>{r.r(t),r.d(t,{default:()=>_});var s=r(609);const l=(0,s.createContext)("block"),a=(0,s.createContext)("data"),i=(0,s.createContext)("input");var n=r(723),o=r(427),c=r(790);const d=({externalObject:e,submitTitle:t,submitDisabled:r,onSubmit:l})=>{const[a,i]=(0,s.useState)(null!=r&&r);return void 0!==e&&(e.setDisabledSubmit=e=>i(e)),(0,c.jsx)(o.Button,{disabled:a,variant:a?"":"primary",text:t,onClick:()=>{void 0!==l&&l()}})},u=({externalObject:e,title:t,openButton:r,openCallback:l,submitTitle:a,submitCallback:i,submitDisabled:u,...x})=>{const[m,h]=(0,s.useState)(!1),b=()=>{h(!1)};return(0,c.jsxs)(c.Fragment,{children:[{...r,props:{...r.props,onClick:()=>{void 0!==l&&l(),h(!0)}}},m&&(0,c.jsxs)(o.Modal,{size:"medium",title:t,onRequestClose:b,children:[x.children,(0,c.jsxs)(o.Flex,{style:{marginTop:"3rem"},children:[(0,c.jsx)(o.FlexItem,{children:(0,c.jsx)(o.Button,{variant:"secondary",text:(0,n.__)("Cancel"),onClick:b})}),(0,c.jsx)(o.FlexItem,{children:(0,c.jsx)(d,{externalObject:e,submitTitle:a,submitDisabled:null!=u&&u,onSubmit:()=>{void 0!==i()&&i(),h(!1)}})})]})]})]})};var x=r(445);let m;const h=function({marker:e}){const t=(0,s.useContext)(a),r=(0,s.useContext)(i),[l,n]=(0,s.useState)(e?.position);return(0,s.useEffect)((()=>{r.position=l}),[]),(0,c.jsxs)("div",{className:"select-autocomplete",children:[(0,c.jsx)(x.A,{placeholder:"Type a location...",cacheOptions:!1,defaultOptions:!0,loadOptions:(e,t)=>{clearTimeout(m),m=setTimeout((()=>{((e,t)=>{e=encodeURIComponent(e.trim()),fetch(`https://nominatim.openstreetmap.org/search?q=${e}&format=json`).then((e=>e.json())).then((e=>t(e.map((e=>({label:e.display_name,lat:e.lat,lon:e.lon}))))))})(e,t)}),500)},onChange:e=>{const s=[e.lat,e.lon];n(s),r.position=s,void 0!==t?.marker?.setDisabledSubmit&&t.marker.setDisabledSubmit(!1),t.marker.setTitle(e.label)}}),(0,c.jsxs)(o.Flex,{style:{margin:"0.5rem 0"},children:[(0,c.jsxs)(o.FlexBlock,{children:[(0,c.jsx)("strong",{children:"Latitude"}),": ",l?l[0]:""]}),(0,c.jsxs)(o.FlexBlock,{children:[(0,c.jsx)("strong",{children:"Longitude"}),": ",l?l[1]:""]})]}),(0,c.jsx)("hr",{})]})},b=({title:e,defaultValue:t,onChangeCallback:r})=>{const[l,a]=(0,s.useState)(t),i=e=>{void 0!==r&&r(e),a(e)};return(0,s.useEffect)((()=>{i(t)}),[t]),(0,c.jsxs)(c.Fragment,{children:[void 0===e?"":(0,c.jsx)("strong",{children:e}),(0,c.jsx)(o.TextControl,{style:{marginTop:"2px"},className:"blocks-form-text",value:l,onChange:e=>{i(e)}})]})},j=({title:e,defaultValue:t,onChangeCallback:r})=>{const[l,a]=(0,s.useState)(t),i=e=>{void 0!==r&&r(e),a(e)};return(0,s.useEffect)((()=>{i(t)}),[t]),(0,c.jsxs)(c.Fragment,{children:[void 0===e?"":(0,c.jsx)("strong",{children:e}),(0,c.jsx)(o.TextareaControl,{style:{marginTop:"2px"},className:"blocks-form-text",value:l,onChange:e=>{a(e),void 0!==r&&i(e)}})]})},k=({marker:e})=>{var t;const r=(0,s.useContext)(a),l=(0,s.useContext)(i),[o,d]=(0,s.useState)(null!==(t=e?.title)&&void 0!==t?t:"");return r.marker.setTitle=e=>d(e),(0,c.jsx)(b,{title:(0,n.__)("Marker Title"),defaultValue:o,onChangeCallback:e=>{l.title=e}})},p=({marker:e})=>{var t;const r=(0,s.useContext)(i);return(0,c.jsx)(j,{title:(0,n.__)("Description"),defaultValue:null!==(t=e?.description)&&void 0!==t?t:"",onChangeCallback:e=>{r.description=e}})},C=({marker:e})=>((0,s.useContext)(i).id=e.id,(0,c.jsxs)(o.Flex,{className:"blocks-form",direction:"column",children:[(0,c.jsx)(o.FlexBlock,{children:(0,c.jsx)(h,{marker:e})}),(0,c.jsx)(o.FlexBlock,{children:(0,c.jsx)(k,{marker:e})}),(0,c.jsx)(o.FlexBlock,{children:(0,c.jsx)(p,{marker:e})})]})),g=({marker:e})=>{const t=(0,s.useContext)(l),r=(0,s.useContext)(i);return(0,c.jsxs)(o.Flex,{style:{width:"100%"},children:[(0,c.jsx)(o.FlexBlock,{children:e.title}),(0,c.jsx)(o.FlexItem,{style:{maxWidth:"70px"},children:(0,c.jsxs)(o.Flex,{gap:0,children:[(0,c.jsx)(o.FlexItem,{children:(0,c.jsx)(u,{title:(0,n.__)("Edit marker"),openButton:(0,c.jsx)(o.Button,{icon:"edit"}),submitTitle:(0,n.__)("Save changes"),submitCallback:()=>{const s=JSON.parse(JSON.stringify(t.attributes));s.markers=s.markers.filter((t=>t.id!==e.id)),t.setAttributes({...s,markers:[...s.markers,r]})},children:(0,c.jsx)(C,{marker:e})})}),(0,c.jsx)(o.FlexItem,{children:(0,c.jsx)(u,{title:(0,n.__)("Delete marker"),openButton:(0,c.jsx)(o.Button,{style:{color:"red"},icon:"dismiss"}),submitTitle:(0,n.__)("Delete marker"),submitCallback:()=>{const r=JSON.parse(JSON.stringify(t.attributes));r.markers=r.markers.filter((t=>t.id!==e.id)),t.setAttributes(r)},children:(0,c.jsx)("h1",{children:"Do you want to delete the marker?"})})})]})})]})},v=()=>{const e=(0,s.useContext)(l),t=(0,s.useContext)(a),r=(0,s.useContext)(i);return(0,c.jsxs)(o.Flex,{direction:"column",style:{width:"100%"},children:[(0,c.jsx)(o.FlexBlock,{children:(0,c.jsx)(u,{externalObject:t.marker,title:(0,n.__)("New marker"),openButton:(0,c.jsx)(o.Button,{variant:"primary",text:(0,n.__)("Add new marker")}),submitTitle:(0,n.__)("Add marker"),submitDisabled:!0,submitCallback:()=>{const t=JSON.parse(JSON.stringify(e.attributes));e.setAttributes({...t,markers:[...t.markers,r]})},children:(0,c.jsx)(C,{marker:{id:Date.now()}})})}),0===e.attributes.markers.length?"":(0,c.jsxs)(o.FlexBlock,{children:[(0,c.jsx)("hr",{}),e.attributes?.markers?.map((e=>(0,c.jsx)(g,{marker:e},e.id)))]})]})},_=e=>{var t;return(0,c.jsx)(l.Provider,{value:e,children:(0,c.jsx)(a.Provider,{value:{marker:{}},children:(0,c.jsxs)(i.Provider,{value:{},children:[(0,c.jsx)(o.PanelBody,{title:(0,n.__)("Markers"),children:(0,c.jsx)(o.PanelRow,{children:(0,c.jsx)(v,{})})}),(0,c.jsx)(o.PanelBody,{title:(0,n.__)("Layer"),children:(0,c.jsx)(o.PanelRow,{children:(0,c.jsx)(o.RadioControl,{selected:e?.attributes?.layer,options:LAYERS.map((e=>({label:e.name,value:e.layer}))),onChange:t=>{e.setAttributes({...e?.attributes,layer:t})}})})}),(0,c.jsx)(o.PanelBody,{title:(0,n.__)("Map height"),children:(0,c.jsx)(o.PanelRow,{children:(0,c.jsx)(o.RangeControl,{value:e?.attributes?.height,onChange:t=>{e.setAttributes({...e?.attributes,height:t})},step:10,min:300,max:2e3})})}),e?.attributes?.markers.length>1?"":(0,c.jsx)(o.PanelBody,{title:(0,n.__)("Map zoom"),children:(0,c.jsx)(o.PanelRow,{children:(0,c.jsx)(o.RangeControl,{value:e?.attributes?.zoom,onChange:t=>{e.setAttributes({...e?.attributes,zoom:t})},step:1,min:2,max:18})})}),(0,c.jsx)(o.PanelBody,{title:(0,n.__)("Color markers"),children:(0,c.jsx)(o.PanelRow,{children:(0,c.jsx)(o.ColorPicker,{color:e?.attributes?.markersColor,onChange:t=>{e.setAttributes({...e?.attributes,markersColor:t})},enableAlpha:!1,defaultValue:null!==(t=e?.attributes?.markersColor)&&void 0!==t?t:"#006ba1"})})})]})})})}}}]);